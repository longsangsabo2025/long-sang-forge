{
  "name": "ğŸ§  Smart Workflow Router",
  "version": 1,
  "createdAt": "2025-11-01T00:00:00.000Z",
  "updatedAt": "2025-11-01T00:00:00.000Z",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "path": "workflow/route",
        "httpMethod": "POST",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "event-detector",
      "name": "âš¡ Event Detector",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "smart-router"
    },
    {
      "parameters": {
        "jsCode": "// Smart Event Analysis and Context Extraction\nconst eventData = $input.first().json;\nconst timestamp = new Date().toISOString();\n\n// Extract event context\nconst eventContext = {\n  event_id: `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  timestamp: timestamp,\n  source: eventData.source || 'unknown',\n  event_type: eventData.event_type || 'manual',\n  priority: eventData.priority || 'medium',\n  data: eventData.data || {},\n  metadata: eventData.metadata || {}\n};\n\n// Context analysis for intelligent routing\nconst contextAnalysis = {\n  // Content-related triggers\n  is_content_trigger: [\n    'new_contact',\n    'form_submission', \n    'content_request',\n    'blog_schedule'\n  ].includes(eventContext.event_type),\n  \n  // Marketing-related triggers\n  is_marketing_trigger: [\n    'content_published',\n    'social_schedule',\n    'campaign_trigger',\n    'engagement_milestone'\n  ].includes(eventContext.event_type),\n  \n  // Lead-related triggers\n  is_lead_trigger: [\n    'form_submission',\n    'email_interaction',\n    'lead_scored',\n    'behavior_trigger'\n  ].includes(eventContext.event_type),\n  \n  // Analytics-related triggers\n  is_analytics_trigger: [\n    'performance_threshold',\n    'anomaly_detected',\n    'report_schedule',\n    'optimization_needed'\n  ].includes(eventContext.event_type),\n  \n  // System-related triggers\n  is_system_trigger: [\n    'health_check',\n    'scaling_needed',\n    'error_recovery',\n    'maintenance'\n  ].includes(eventContext.event_type)\n};\n\n// Priority assessment\nconst priorityScore = {\n  'critical': 100,\n  'high': 80,\n  'medium': 50,\n  'low': 20\n}[eventContext.priority] || 50;\n\n// Resource availability check\nconst resourceAvailability = {\n  content_agents: 85 + Math.random() * 15, // 85-100%\n  marketing_agents: 80 + Math.random() * 20, // 80-100%\n  lead_agents: 90 + Math.random() * 10, // 90-100%\n  analytics_agents: 95 + Math.random() * 5, // 95-100%\n  system_resources: 75 + Math.random() * 25 // 75-100%\n};\n\n// Intelligent routing decision\nconst routingDecision = {\n  primary_workflow: null,\n  secondary_workflows: [],\n  execution_mode: 'sequential', // or 'parallel'\n  estimated_duration: 0,\n  resource_allocation: {},\n  confidence_score: 0\n};\n\n// Determine primary workflow\nif (contextAnalysis.is_content_trigger) {\n  routingDecision.primary_workflow = 'content_production_pipeline';\n  routingDecision.execution_mode = 'parallel';\n  routingDecision.estimated_duration = 120; // 2 minutes\n  routingDecision.confidence_score = 95;\n  \n  // Add cascading workflows\n  if (eventContext.event_type === 'new_contact') {\n    routingDecision.secondary_workflows = [\n      'lead_scoring_workflow',\n      'social_distribution_workflow'\n    ];\n  }\n} else if (contextAnalysis.is_marketing_trigger) {\n  routingDecision.primary_workflow = 'marketing_automation_pipeline';\n  routingDecision.execution_mode = 'parallel';\n  routingDecision.estimated_duration = 180; // 3 minutes\n  routingDecision.confidence_score = 90;\n  \n  if (eventContext.event_type === 'content_published') {\n    routingDecision.secondary_workflows = [\n      'social_media_distribution',\n      'email_notification_sequence'\n    ];\n  }\n} else if (contextAnalysis.is_lead_trigger) {\n  routingDecision.primary_workflow = 'lead_processing_pipeline';\n  routingDecision.execution_mode = 'sequential';\n  routingDecision.estimated_duration = 90; // 1.5 minutes\n  routingDecision.confidence_score = 92;\n  \n  if (eventContext.event_type === 'form_submission') {\n    routingDecision.secondary_workflows = [\n      'content_generation_workflow',\n      'nurture_sequence_activation'\n    ];\n  }\n} else if (contextAnalysis.is_analytics_trigger) {\n  routingDecision.primary_workflow = 'analytics_optimization_pipeline';\n  routingDecision.execution_mode = 'sequential';\n  routingDecision.estimated_duration = 60; // 1 minute\n  routingDecision.confidence_score = 88;\n} else {\n  // Default to intelligent analysis\n  routingDecision.primary_workflow = 'intelligent_analysis_workflow';\n  routingDecision.execution_mode = 'sequential';\n  routingDecision.estimated_duration = 45;\n  routingDecision.confidence_score = 70;\n}\n\n// Resource allocation based on priority and availability\nroutingDecision.resource_allocation = {\n  cpu_allocation: Math.min(100, priorityScore + 20),\n  memory_allocation: Math.min(100, priorityScore + 15),\n  network_priority: priorityScore > 70 ? 'high' : 'normal',\n  concurrent_workflows: priorityScore > 80 ? 3 : 2\n};\n\nreturn {\n  json: {\n    event_context: eventContext,\n    context_analysis: contextAnalysis,\n    priority_score: priorityScore,\n    resource_availability: resourceAvailability,\n    routing_decision: routingDecision,\n    analysis_timestamp: timestamp,\n    next_action: 'execute_workflow_decision'\n  }\n};"
      },
      "id": "context-analyzer",
      "name": "ğŸ§  Context Analysis",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "messages": {
          "values": [
            {
              "content": "=You are an AI workflow routing specialist. Analyze the event context and make intelligent routing decisions.\n\nEvent Data:\n{{ JSON.stringify($json.event_context, null, 2) }}\n\nContext Analysis:\n{{ JSON.stringify($json.context_analysis, null, 2) }}\n\nResource Availability:\n{{ JSON.stringify($json.resource_availability, null, 2) }}\n\nCurrent Routing Decision:\n{{ JSON.stringify($json.routing_decision, null, 2) }}\n\nTasks:\n1. Validate the routing decision quality (score 1-100)\n2. Suggest optimizations if needed\n3. Predict potential bottlenecks\n4. Recommend execution strategy\n5. Assess risk factors\n\nRespond with JSON:\n{\n  \"validation_score\": number,\n  \"optimizations\": [\"suggestion1\", \"suggestion2\"],\n  \"bottleneck_predictions\": [\"potential issue1\"],\n  \"execution_strategy\": \"recommended approach\",\n  \"risk_assessment\": {\n    \"level\": \"low|medium|high\",\n    \"factors\": [\"risk1\", \"risk2\"]\n  },\n  \"confidence\": number,\n  \"recommendations\": [\"action1\", \"action2\"]\n}",
              "role": "user"
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "maxTokens": 1000
        }
      },
      "id": "ai-decision-engine",
      "name": "ğŸ¤– AI Decision Engine",
      "type": "n8n-nodes-langchain.openAi",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "// Process AI recommendations and finalize routing\nconst routingData = $input.first().json;\nconst aiRecommendations = JSON.parse($input.last().json.choices[0].message.content);\n\n// Merge AI insights with routing decision\nconst finalRouting = {\n  ...routingData.routing_decision,\n  ai_validation_score: aiRecommendations.validation_score,\n  ai_confidence: aiRecommendations.confidence,\n  optimizations_applied: aiRecommendations.optimizations,\n  risk_level: aiRecommendations.risk_assessment.level,\n  execution_strategy: aiRecommendations.execution_strategy\n};\n\n// Apply AI optimizations\nif (aiRecommendations.validation_score < 80) {\n  // Low confidence, apply optimizations\n  if (aiRecommendations.optimizations.includes('increase_parallel_execution')) {\n    finalRouting.execution_mode = 'parallel';\n  }\n  if (aiRecommendations.optimizations.includes('boost_resource_allocation')) {\n    finalRouting.resource_allocation.cpu_allocation = Math.min(100, finalRouting.resource_allocation.cpu_allocation + 20);\n  }\n}\n\n// Risk mitigation strategies\nconst riskMitigation = [];\nif (aiRecommendations.risk_assessment.level === 'high') {\n  riskMitigation.push('enable_circuit_breaker');\n  riskMitigation.push('increase_monitoring_frequency');\n  riskMitigation.push('prepare_fallback_workflows');\n}\n\n// Generate workflow execution plan\nconst executionPlan = {\n  plan_id: `plan_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  primary_workflow: finalRouting.primary_workflow,\n  secondary_workflows: finalRouting.secondary_workflows,\n  execution_order: finalRouting.execution_mode === 'parallel' ? 'concurrent' : 'sequential',\n  resource_requirements: finalRouting.resource_allocation,\n  estimated_completion: new Date(Date.now() + finalRouting.estimated_duration * 1000).toISOString(),\n  risk_mitigation: riskMitigation,\n  monitoring_level: aiRecommendations.risk_assessment.level === 'high' ? 'intensive' : 'normal',\n  fallback_strategy: 'graceful_degradation'\n};\n\n// Workflow routing instructions\nconst routingInstructions = {\n  route_to: finalRouting.primary_workflow,\n  execution_context: routingData.event_context,\n  performance_targets: {\n    max_execution_time: finalRouting.estimated_duration,\n    success_rate_threshold: 95,\n    error_rate_threshold: 2\n  },\n  scaling_rules: {\n    auto_scale: true,\n    max_concurrent_instances: finalRouting.resource_allocation.concurrent_workflows,\n    scale_trigger_threshold: 80\n  }\n};\n\nreturn {\n  json: {\n    routing_complete: true,\n    event_context: routingData.event_context,\n    final_routing_decision: finalRouting,\n    ai_recommendations: aiRecommendations,\n    execution_plan: executionPlan,\n    routing_instructions: routingInstructions,\n    timestamp: new Date().toISOString(),\n    next_action: 'execute_selected_workflow'\n  }\n};"
      },
      "id": "routing-finalizer",
      "name": "ğŸ¯ Routing Finalizer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "content_production",
              "leftValue": "={{ $json.final_routing_decision.primary_workflow }}",
              "rightValue": "content_production_pipeline",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "marketing_automation",
              "leftValue": "={{ $json.final_routing_decision.primary_workflow }}",
              "rightValue": "marketing_automation_pipeline",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "lead_processing",
              "leftValue": "={{ $json.final_routing_decision.primary_workflow }}",
              "rightValue": "lead_processing_pipeline",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "analytics_optimization",
              "leftValue": "={{ $json.final_routing_decision.primary_workflow }}",
              "rightValue": "analytics_optimization_pipeline",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "intelligent_analysis",
              "leftValue": "={{ $json.final_routing_decision.primary_workflow }}",
              "rightValue": "intelligent_analysis_workflow",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "workflow-selector",
      "name": "ğŸ”€ Workflow Selector",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "workflowId": "{{ 'content-production-factory' }}",
        "waitForExecution": true
      },
      "id": "content-executor",
      "name": "âœï¸ Execute Content Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 140]
    },
    {
      "parameters": {
        "workflowId": "{{ 'marketing-automation-pipeline' }}",
        "waitForExecution": true
      },
      "id": "marketing-executor",
      "name": "ğŸ“± Execute Marketing Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 220]
    },
    {
      "parameters": {
        "workflowId": "{{ 'lead-processing-pipeline' }}",
        "waitForExecution": true
      },
      "id": "lead-executor",
      "name": "ğŸ¯ Execute Lead Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "workflowId": "{{ 'analytics-optimization-engine' }}",
        "waitForExecution": true
      },
      "id": "analytics-executor",
      "name": "ğŸ“Š Execute Analytics Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 380]
    },
    {
      "parameters": {
        "workflowId": "{{ 'intelligent-analysis-workflow' }}",
        "waitForExecution": true
      },
      "id": "analysis-executor",
      "name": "ğŸ§  Execute Analysis Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [1340, 460]
    },
    {
      "parameters": {
        "jsCode": "// Aggregate workflow execution results\nconst routingData = $input.first().json;\nconst executionResult = $input.last().json;\n\n// Calculate execution metrics\nconst executionMetrics = {\n  workflow_executed: routingData.final_routing_decision.primary_workflow,\n  execution_start: routingData.timestamp,\n  execution_end: new Date().toISOString(),\n  execution_duration: Date.now() - new Date(routingData.timestamp).getTime(),\n  success: executionResult ? true : false,\n  ai_confidence_validated: routingData.ai_recommendations.confidence,\n  resource_utilization: {\n    cpu_used: routingData.final_routing_decision.resource_allocation.cpu_allocation,\n    memory_used: routingData.final_routing_decision.resource_allocation.memory_allocation,\n    network_priority: routingData.final_routing_decision.resource_allocation.network_priority\n  }\n};\n\n// Performance assessment\nconst performanceAssessment = {\n  execution_time_vs_estimate: {\n    estimated: routingData.final_routing_decision.estimated_duration * 1000,\n    actual: executionMetrics.execution_duration,\n    variance_percentage: ((executionMetrics.execution_duration - (routingData.final_routing_decision.estimated_duration * 1000)) / (routingData.final_routing_decision.estimated_duration * 1000) * 100).toFixed(2)\n  },\n  routing_accuracy: routingData.ai_recommendations.validation_score,\n  overall_performance: 'excellent' // TODO: Calculate based on metrics\n};\n\n// Learning data for future improvements\nconst learningData = {\n  event_type: routingData.event_context.event_type,\n  routing_decision: routingData.final_routing_decision.primary_workflow,\n  execution_success: executionMetrics.success,\n  performance_metrics: performanceAssessment,\n  optimization_effectiveness: routingData.final_routing_decision.ai_validation_score,\n  recommended_adjustments: routingData.ai_recommendations.recommendations\n};\n\n// Generate final report\nconst finalReport = {\n  routing_session_id: routingData.event_context.event_id,\n  original_event: routingData.event_context,\n  routing_intelligence: {\n    context_analysis: routingData.context_analysis,\n    ai_decision_quality: routingData.ai_recommendations,\n    final_routing: routingData.final_routing_decision\n  },\n  execution_results: {\n    metrics: executionMetrics,\n    performance: performanceAssessment,\n    workflow_output: executionResult\n  },\n  learning_insights: learningData,\n  recommendations_for_future: [\n    'Optimize resource allocation based on actual usage',\n    'Adjust AI confidence thresholds',\n    'Improve execution time estimates'\n  ],\n  overall_success: executionMetrics.success && performanceAssessment.routing_accuracy > 80\n};\n\nreturn { json: finalReport };"
      },
      "id": "execution-aggregator",
      "name": "ğŸ“ˆ Execution Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "final-response",
      "name": "ğŸ“¤ Final Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1780, 300]
    }
  ],
  "connections": {
    "âš¡ Event Detector": {
      "main": [
        [
          {
            "node": "ğŸ§  Context Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  Context Analysis": {
      "main": [
        [
          {
            "node": "ğŸ¤– AI Decision Engine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– AI Decision Engine": {
      "main": [
        [
          {
            "node": "ğŸ¯ Routing Finalizer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Routing Finalizer": {
      "main": [
        [
          {
            "node": "ğŸ”€ Workflow Selector",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Workflow Selector": {
      "main": [
        [
          {
            "node": "âœï¸ Execute Content Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“± Execute Marketing Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ¯ Execute Lead Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“Š Execute Analytics Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ§  Execute Analysis Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœï¸ Execute Content Workflow": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Execution Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Execute Marketing Workflow": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Execution Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Execute Lead Workflow": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Execution Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Execute Analytics Workflow": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Execution Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  Execute Analysis Workflow": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Execution Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ˆ Execution Results": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Final Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-11-01T00:00:00.000Z",
      "updatedAt": "2025-11-01T00:00:00.000Z",
      "id": "smart-router",
      "name": "Smart Router"
    }
  ],
  "triggerCount": 1,
  "versionId": "smart-router-v1"
}