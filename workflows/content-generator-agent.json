{
  "name": "Content Generator Agent",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "content-generator",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "aec5dac3-a1d1-4b89-a15a-f1a97e13e26e",
      "name": "Content Request Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "content-generator-agent"
    },
    {
      "parameters": {
        "functionCode": "// Extract and validate content request parameters\nconst requestData = $json.body || $json;\n\n// Validate required fields\nif (!requestData.topic_keywords || !requestData.content_type) {\n  throw new Error('Missing required fields: topic_keywords, content_type');\n}\n\n// Set defaults\nconst contentRequest = {\n  topic_keywords: requestData.topic_keywords,\n  target_audience: requestData.target_audience || 'tech professionals',\n  content_type: requestData.content_type || 'blog',\n  language: requestData.language || 'en',\n  word_count: requestData.word_count || 800,\n  seo_focus: requestData.seo_focus || true,\n  user_id: requestData.user_id || 'system',\n  timestamp: new Date().toISOString()\n};\n\n// Generate content prompt based on type\nlet systemPrompt = '';\nlet contentPrompt = '';\n\nswitch (contentRequest.content_type) {\n  case 'blog':\n    systemPrompt = 'You are a professional tech blogger who creates engaging, SEO-optimized content about automation and AI.';\n    contentPrompt = `Write a comprehensive blog post about: ${contentRequest.topic_keywords.join(', ')}\n\nTarget audience: ${contentRequest.target_audience}\nWord count: ${contentRequest.word_count}\nLanguage: ${contentRequest.language}\n\nInclude:\n- Engaging title and introduction\n- Well-structured sections with headings\n- Practical examples and use cases\n- Call-to-action at the end\n- SEO-friendly meta description`;\n    break;\n    \n  case 'landing':\n    systemPrompt = 'You are a conversion-focused copywriter who creates compelling landing page content.';\n    contentPrompt = `Create landing page content for: ${contentRequest.topic_keywords.join(', ')}\n\nTarget audience: ${contentRequest.target_audience}\nLanguage: ${contentRequest.language}\n\nInclude:\n- Compelling headline\n- Value proposition\n- Benefits and features\n- Social proof section\n- Strong call-to-action\n- FAQ section`;\n    break;\n    \n  case 'service':\n    systemPrompt = 'You are a service description specialist who creates clear, benefit-focused content.';\n    contentPrompt = `Write service page content for: ${contentRequest.topic_keywords.join(', ')}\n\nTarget audience: ${contentRequest.target_audience}\nLanguage: ${contentRequest.language}\n\nInclude:\n- Service overview\n- Key benefits\n- Process/methodology\n- Pricing structure\n- Getting started section`;\n    break;\n    \n  default:\n    throw new Error(`Unsupported content type: ${contentRequest.content_type}`);\n}\n\nreturn {\n  ...contentRequest,\n  system_prompt: systemPrompt,\n  content_prompt: contentPrompt,\n  processing_id: `content_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n};"
      },
      "id": "f1b8d739-f2c3-4e8a-9b3a-7c6e8d4a5b2c",
      "name": "Process Content Request",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "={{ $json.system_prompt }}"
            },
            {
              "role": "user", 
              "content": "={{ $json.content_prompt }}"
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 2000
        }
      },
      "id": "d4e7f8a1-b2c5-6d9e-0f1a-3b4c5d6e7f8a",
      "name": "Generate Content with AI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1,
      "position": [680, 300],
      "credentials": {
        "openAiApi": {
          "id": "openai-content-gen",
          "name": "OpenAI Content Generation"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "// Process AI-generated content and extract components\nconst aiResponse = $json.response || $json.message?.content || $json;\nconst originalRequest = $('Process Content Request').first().json;\n\n// Parse the generated content\nlet title = '';\nlet content = '';\nlet metaDescription = '';\nlet tags = [];\n\n// Extract title (usually the first line or # heading)\nconst lines = aiResponse.split('\\n');\nfor (const line of lines) {\n  if (line.startsWith('#') || (!title && line.trim().length > 0)) {\n    title = line.replace(/^#+\\s*/, '').trim();\n    break;\n  }\n}\n\n// Extract content (everything after title)\ncontent = aiResponse.replace(title, '').trim();\n\n// Generate meta description (first 155 characters of content)\nconst plainContent = content.replace(/#+\\s*/g, '').replace(/\\*\\*/g, '').replace(/\\*/g, '');\nmetaDescription = plainContent.substring(0, 155).trim() + '...';\n\n// Extract or generate tags from keywords\ntags = originalRequest.topic_keywords.map(keyword => \n  keyword.toLowerCase().replace(/\\s+/g, '-')\n);\n\n// Calculate SEO score (basic scoring)\nlet seoScore = 0;\nif (title.length >= 30 && title.length <= 60) seoScore += 20;\nif (metaDescription.length >= 120 && metaDescription.length <= 155) seoScore += 20;\nif (content.length >= originalRequest.word_count * 0.8) seoScore += 20;\nif (originalRequest.topic_keywords.some(keyword => \n  title.toLowerCase().includes(keyword.toLowerCase())\n)) seoScore += 20;\nif (content.split('\\n').filter(line => line.startsWith('#')).length >= 3) seoScore += 20;\n\nconst processedContent = {\n  processing_id: originalRequest.processing_id,\n  content_type: originalRequest.content_type,\n  language: originalRequest.language,\n  title: title || 'Generated Content',\n  content: content,\n  meta_description: metaDescription,\n  tags: tags,\n  seo_score: seoScore,\n  word_count: content.split(/\\s+/).length,\n  generated_at: new Date().toISOString(),\n  user_id: originalRequest.user_id,\n  status: 'generated',\n  quality_score: Math.min(100, Math.max(0, seoScore + (content.length / originalRequest.word_count * 20)))\n};\n\nreturn processedContent;"
      },
      "id": "c3d4e5f6-a7b8-9c0d-1e2f-4a5b6c7d8e9f",
      "name": "Process Generated Content",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "content_queue",
        "columns": {
          "values": {
            "id": "={{ $json.processing_id }}",
            "title": "={{ $json.title }}",
            "content": "={{ $json.content }}",
            "type": "={{ $json.content_type }}",
            "status": "ready",
            "language": "={{ $json.language }}",
            "metadata": "={{ JSON.stringify({\n  meta_description: $json.meta_description,\n  tags: $json.tags,\n  seo_score: $json.seo_score,\n  word_count: $json.word_count,\n  quality_score: $json.quality_score\n}) }}",\n            "created_at": "={{ $json.generated_at }}",\n            "created_by": "content-generator-agent"\n          }\n        }\n      },\n      "id": "b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d7e",\n      "name": "Store in Content Queue",\n      "type": "n8n-nodes-base.supabase",\n      "typeVersion": 1,\n      "position": [1120, 300],\n      "credentials": {\n        "supabaseApi": {\n          "id": "supabase-main",\n          "name": "Supabase Main Database"\n        }\n      }\n    },\n    {\n      "parameters": {\n        "functionCode": "// Trigger follow-up actions based on content type\nconst contentData = $json;\nconst actions = [];\n\n// Determine follow-up actions\nswitch (contentData.content_type) {\n  case 'blog':\n    actions.push({\n      action: 'schedule_social_posts',\n      data: {\n        source_content: contentData.title,\n        platforms: ['twitter', 'linkedin', 'facebook'],\n        schedule_delay: '1_hour'\n      }\n    });\n    actions.push({\n      action: 'update_seo_sitemap',\n      data: {\n        url_slug: contentData.title.toLowerCase().replace(/[^a-z0-9]+/g, '-'),\n        meta_description: contentData.meta_description\n      }\n    });\n    break;\n    \n  case 'landing':\n    actions.push({\n      action: 'notify_marketing_team',\n      data: {\n        content_id: contentData.processing_id,\n        landing_page_ready: true\n      }\n    });\n    break;\n    \n  case 'service':\n    actions.push({\n      action: 'update_portfolio',\n      data: {\n        service_description: contentData.title,\n        content_id: contentData.processing_id\n      }\n    });\n    break;\n}\n\n// Add analytics tracking\nactions.push({\n  action: 'track_content_generation',\n  data: {\n    content_type: contentData.content_type,\n    quality_score: contentData.quality_score,\n    processing_time: Date.now(),\n    agent: 'content-generator'\n  }\n});\n\nreturn {\n  success: true,\n  content_id: contentData.processing_id,\n  content_type: contentData.content_type,\n  quality_score: contentData.quality_score,\n  follow_up_actions: actions,\n  message: 'Content generated and queued successfully',\n  timestamp: new Date().toISOString()\n};"
      },\n      "id": "a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6d",\n      "name": "Trigger Follow-up Actions",\n      "type": "n8n-nodes-base.function",\n      "typeVersion": 1,\n      "position": [1340, 300]\n    },\n    {\n      "parameters": {\n        "conditions": {\n          "number": [\n            {\n              "value1": "={{ $json.quality_score }}",\n              "operation": "largerEqual",\n              "value2": 75\n            }\n          ]\n        }\n      },\n      "id": "d5e6f7a8-b9c0-1d2e-3f4a-5b6c7d8e9f0a",\n      "name": "Quality Check",\n      "type": "n8n-nodes-base.if",\n      "typeVersion": 1,\n      "position": [1120, 480]\n    },\n    {\n      "parameters": {\n        "url": "={{ $('Content Request Webhook').first().json.webhook_url || 'http://localhost:5678/webhook/smart-workflow-router' }}",\n        "sendBody": true,\n        "bodyParameters": {\n          "values": [\n            {\n              "name": "action",\n              "value": "route_workflow"\n            },\n            {\n              "name": "event_type",\n              "value": "content_ready"\n            },\n            {\n              "name": "event_data",\n              "value": "={{ JSON.stringify($json) }}"\n            },\n            {\n              "name": "user_id",\n              "value": "={{ $json.user_id }}"\n            }\n          ]\n        },\n        "options": {\n          "timeout": 10000\n        }\n      },\n      "id": "e7f8a9b0-c1d2-3e4f-5a6b-7c8d9e0f1a2b",\n      "name": "Notify Smart Router",\n      "type": "n8n-nodes-base.httpRequest",\n      "typeVersion": 1,\n      "position": [1340, 400]\n    },\n    {\n      "parameters": {\n        "message": ":warning: Content quality below threshold",\n        "additionalFields": {\n          "blocks": [\n            {\n              "type": "section",\n              "text": {\n                "type": "mrkdwn",\n                "text": "*Content Quality Alert*\\n\\nGenerated content has quality score: {{ $json.quality_score }}\\nContent ID: {{ $json.processing_id }}\\nType: {{ $json.content_type }}\\n\\nManual review recommended."\n              }\n            }\n          ]\n        }\n      },\n      "id": "f9a0b1c2-d3e4-5f6a-7b8c-9d0e1f2a3b4c",\n      "name": "Low Quality Alert",\n      "type": "n8n-nodes-base.slack",\n      "typeVersion": 1,\n      "position": [1340, 560],\n      "credentials": {\n        "slackApi": {\n          "id": "slack-alerts",\n          "name": "Slack Alerts Channel"\n        }\n      }\n    },\n    {\n      "parameters": {\n        "responseBody": "={{ JSON.stringify($json) }}",\n        "options": {\n          "responseHeaders": {\n            "entries": [\n              {\n                "name": "Content-Type",\n                "value": "application/json"\n              }\n            ]\n          }\n        }\n      },\n      "id": "a3b4c5d6-e7f8-9a0b-1c2d-3e4f5a6b7c8d",\n      "name": "Response",\n      "type": "n8n-nodes-base.respondToWebhook",\n      "typeVersion": 1,\n      "position": [1560, 300]\n    }\n  ],\n  "connections": {\n    "Content Request Webhook": {\n      "main": [\n        [\n          {\n            "node": "Process Content Request",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Process Content Request": {\n      "main": [\n        [\n          {\n            "node": "Generate Content with AI",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Generate Content with AI": {\n      "main": [\n        [\n          {\n            "node": "Process Generated Content",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Process Generated Content": {\n      "main": [\n        [\n          {\n            "node": "Store in Content Queue",\n            "type": "main",\n            "index": 0\n          },\n          {\n            "node": "Quality Check",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Store in Content Queue": {\n      "main": [\n        [\n          {\n            "node": "Trigger Follow-up Actions",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Trigger Follow-up Actions": {\n      "main": [\n        [\n          {\n            "node": "Response",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "Quality Check": {\n      "main": [\n        [\n          {\n            "node": "Notify Smart Router",\n            "type": "main",\n            "index": 0\n          }\n        ],\n        [\n          {\n            "node": "Low Quality Alert",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    }\n  },\n  "settings": {\n    "saveDataErrorExecution": "all",\n    "saveDataSuccessExecution": "all",\n    "saveManualExecutions": true,\n    "callerPolicy": "workflowsFromSameOwner"\n  },\n  "staticData": {},\n  "tags": [\n    {\n      "createdAt": "2025-11-01T00:00:00.000Z",\n      "updatedAt": "2025-11-01T00:00:00.000Z",\n      "id": "content-agent",\n      "name": "Content Agent"\n    }\n  ],\n  "triggerCount": 1,\n  "updatedAt": "2025-11-01T00:00:00.000Z",\n  "versionId": "1"\n}